<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Custom Markdown Parser</title>
    <style>
        body { display: flex; height: 100vh; margin: 0; }

        #input, #output { padding: 1em; flex: 1; resize: none; overflow-y: scroll; }

        img { max-width: 300px; max-height: 300px; float: right; border: 2px outset lightgrey; margin-left: 1em; margin-bottom: 1em; }

        h1, h2, h3 { clear: right; }
        h1, h2 { border-bottom: 1px solid lightgrey; }

        li.unchecked, li.checked { list-style: none; position: relative; }
        li.unchecked:before, li.checked:before { content: ""; border: 1.5px solid black; width: 10px; height: 10px; position: absolute; left: -18px; top: 2px; border-radius: 2px; }
        li.checked:after { content: "✓"; color: #2af; position: absolute; left: -16px; top: -3px; text-shadow: 0 0 2px white, 0 0 2px white, 0 0 2px white, 0 0 2px white, 0 0 2px white, 0 0 2px white, 0 0 2px white, 0 0 2px white, 0 0 2px white, 0 0 2px white, 0 0 2px white, 0 0 2px white, 0 0 2px white, 0 0 2px white, 0 0 2px white, 0 0 2px white, 0 0 2px white, 0 0 2px white; }
    </style>
    <script>
        function replaceSymbols(string) {

            return string.replaceAll("<-", "←").replaceAll("->", "→").replaceAll("!=", "≠");
        }
        
        function parse() {
            
            const out = document.getElementById("output");
            out.innerHTML = "";
            
            const lines = replaceSymbols(document.getElementById("input").value).split("\n");

            let passage = "";
            let passageType = -1; // 0 = paragraph, 1 = unordered, 2 = ordered, 3 = checkbox

            for (const line of lines) {

                // skip blank lines
                if (line.trim().length === 0)
                    continue;

                if (passageType === 0) {

                    if (line.charAt(0) == '+') {
                        
                        passage += " " + line.substring(1);
                        continue;
                    }
                    
                    out.innerHTML += `<p>${ passage }</p>`;
                }

                else if (passageType === 1) {

                    if (line.indexOf("- ") == 0) {
                        
                        passage += `<li>${ line.substring(2) }</li>`;
                        continue;
                    }

                    out.innerHTML += `<ul>${ passage }</ul>`;
                }

                else if (passageType === 2) {

                    if (line.indexOf("-. ") == 0) {
                        
                        passage += `<li>${ line.substring(3) }</li>`;
                        continue;
                    }

                    out.innerHTML += `<ol>${ passage }</ol>`;
                }

                else if (passageType === 3) {

                    if (line.indexOf("[ ] ") == 0) {
                        
                        passage += `<li class="unchecked">${ line.substring(4) }</li>`;
                        continue;
                    }

                    else if (line.indexOf("[X] ") == 0) {

                        passage += `<li class="checked">${ line.substring(4) }</li>`;
                        continue;
                    }

                    out.innerHTML += `<ul>${ passage }</ul>`;
                }
                
                passage = "";
                passageType = -1;

                // prefix:data pairs (can't do this for internal)
                if (line.indexOf("@ ") == 0) {
                    out.innerHTML += `<img src="${ line.substring(2) }">`;
                } else if (line.indexOf("### ") == 0) {
                    out.innerHTML += `<h3>${ line.substring(4) }</h3>`;
                } else if (line.indexOf("## ") == 0) {
                    out.innerHTML += `<h2>${ line.substring(3) }</h2>`;
                } else if (line.indexOf("# ") == 0) {
                    out.innerHTML += `<h1>${ line.substring(2) }</h1>`;
                } else if (line.indexOf("[ ] ") == 0) {
                    passage += `<li class="unchecked">${ line.substring(4) }</li>`;
                    passageType = 3;
                } else if (line.indexOf("[X] ") == 0) {
                    passage += `<li class="checked">${ line.substring(4) }</li>`;
                    passageType = 3;
                } else if (line.indexOf("-. ") == 0) {
                    passage += `<li>${ line.substring(3) }</li>`;
                    passageType = 2;
                } else if (line.indexOf("- ") == 0) {
                    passage += `<li>${ line.substring(2) }</li>`;
                    passageType = 1;
                } else {
                    passage += line;
                    passageType = 0;
                }
            }

            if (passage.length !== 0) {
                
                if (passageType === 0) {
                    out.innerHTML += `<p>${ passage }</p>`;
                } else if (passageType === 1) {
                    out.innerHTML += `<ul>${ passage }</ul>`;
                }
            }
        }
    </script>
</head>
<body onload="parse();">
    <textarea id="input" oninput="parse();">
# Custom Markdown Parser

## Shorthand Symbols

<-, ->, !=

## Lists

### Unordered

- Apples
- Oranges
- Pears

### Ordered

-. Kings
-. Queens
-. Knights
        
### Checkbox

[X] Mix flour and eggs.
[ ] Pour into tray.
[ ] Bake for 30 minutes.
        
## Line merging

This line will not get merged.
Hi im another line.

This line will get merged
+with this line.
    
## Example Excerpt

@ https://i.natgeofe.com/n/548467d8-c5f1-4551-9f58-6817a8d2c45e/NationalGeographic_2572187_3x4.jpg

The cat (Felis catus), also referred to as the domestic cat, is
+a small domesticated carnivorous mammal. It is the only domesticated
+species of the family Felidae. Advances in archaeology and genetics
+have shown that the domestication of the cat occurred in the Near
+East around 7500 BC.
        
Cats are commonly kept as a pet and farm cat, but also ranges freely
+as a feral cat avoiding human contact. It is valued by humans for
+companionship and its ability to kill vermin. Its retractable claws
+are adapted to killing small prey species such as mice and rats.</textarea>

    <div id="output"></div>
</body>

</html>
