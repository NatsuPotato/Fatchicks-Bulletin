<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Custom Markdown Parser</title>
    <style>
        body { display: flex; height: 100vh; margin: 0; }

        #input, #output { padding: 1em; flex: 1; }

        img { max-width: 300px; max-height: 300px; float: right; }

        h1, h2, h3 { clear: right; }
        h1, h2 { border-bottom: 1px solid lightgrey; }
    </style>
    <script>
        function parse() {
            
            const out = document.getElementById("output");
            out.innerHTML = "";
            
            const lines = document.getElementById("input").value.split("\n");

            let paragraph = "";

            for (const line of lines) {

                // skip blank lines
                if (line.trim().length === 0)
                    continue;

                // continuous paragraph
                if (line.charAt(0) == '+') {

                    paragraph += " " + line.substring(1);

                } else {

                    out.innerHTML += `<p>${ paragraph }</p>`;
                    paragraph = "";

                    // prefix:data pairs (can't do this for lists or embeds)
                    if (line.indexOf("@ ") == 0) {
                        out.innerHTML += `<img src="${ line.substring(2) }">`;
                    } else if (line.indexOf("### ") == 0) {
                        out.innerHTML += `<h3>${ line.substring(4) }</h3>`;
                    } else if (line.indexOf("## ") == 0) {
                        out.innerHTML += `<h2>${ line.substring(3) }</h2>`;
                    } else if (line.indexOf("# ") == 0) {
                        out.innerHTML += `<h1>${ line.substring(2) }</h1>`;
                    } else {
                        paragraph += line;
                    }
                }
            }

            if (paragraph.length !== 0)
                out.innerHTML += `<p>${ paragraph }</p>`;
        }
    </script>
</head>
<body onload="parse();">
    <textarea id="input" oninput="parse();">
# Custom Markdown Parser
        
## Lists

### Unordered

- Apples
- Oranges
- Pears

### Checkbox

[X] Mix flour and eggs.
[ ] Pour into tray.
[ ] Bake for 30 minutes.
        
## Line merging

This line will not get merged.
Hi im another line.

This line will get merged
+with this line.
    
## Example Excerpt

@ https://i.natgeofe.com/n/548467d8-c5f1-4551-9f58-6817a8d2c45e/NationalGeographic_2572187_3x4.jpg

The cat (Felis catus), also referred to as the domestic cat, is a small domesticated carnivorous mammal.
+It is the only domesticated species of the family Felidae. Advances in archaeology and genetics have
+shown that the domestication of the cat occurred in the Near East around 7500 BC.
        
Cats are commonly kept as a pet and farm cat, but also ranges freely as a feral cat avoiding human contact.
+It is valued by humans for companionship and its ability to kill vermin. Its retractable claws are adapted
+to killing small prey species such as mice and rats. It has a strong, flexible body, quick reflexes, and
+sharp teeth, and its night vision and sense of smell are well developed. It is a social species, but a
+solitary hunter and a crepuscular predator. Cat communication includes vocalizations—including meowing,
+purring, trilling, hissing, growling, and grunting—as well as body language. It can hear sounds too faint
+or too high in frequency for human ears, such as those made by small mammals. It secretes and perceives
+pheromones.</textarea>

    <div id="output"></div>
</body>

</html>
