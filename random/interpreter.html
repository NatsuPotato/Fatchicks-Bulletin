<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Random Program Interpreter</title>
    <style>
        .cats { color: red; }
    </style>
    <script>

        function setOfChildren(parent) {

            let children = new Set();

            parent.childNodes.forEach(node => {
                console.log(node);
                children.add(node);
            });

            return children;
        }

        function recolor() {

            const code = document.getElementById("code");

            code.childNodes.forEach(node => {

                if (node.nodeType == 3) {

                    new Set(Array.from(
                        setOfChildren(
                            new DOMParser().parseFromString(node.wholeText.replaceAll("cats", "<span class='cats'>cats</span>"), 'text/html').body
                        )
                    ).reverse()).forEach(newNode => {
                        node.parentNode.insertBefore(newNode, node.nextSibling);
                    });
                    node.remove();
                }
                else if (node.classList.contains("cats") && node.innerText != "cats") {
                    node.replaceWith(node.innerText);
                }
            });
            
            // https://developer.mozilla.org/en-US/docs/Web/API/Selection
            // https://developer.mozilla.org/en-US/docs/Web/API/Range
            // const start = 10;//window.getSelection().rangeCount == 0 ? -1 : window.getSelection().getRangeAt(0).startOffset;
            
            

            // if (start != -1) {
                
            //     const range = document.createRange();
            //     range.setStart(code, start);
            //     range.setEnd(code, start);
                
            //     const selection = window.getSelection();
            //     selection.removeAllRanges();
            //     selection.addRange(range);
            // }
        }
    </script>
</head>
<body onload="recolor();">
    
    <div oninput="recolor();" id="code" style="tab-size: 4; padding: 1em; border: 1px solid grey; height: 30em;" spellcheck="false" autocorrect="off" autocapitalize="none" translate="no" contenteditable="true" role="textbox" aria-multiline="true">
        one two three
    </div>
    
</body>
</html>
